<!-- #BeginTemplate "/Templates/manual-page.dwt" --><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<!-- #TemplateBeginEditable name="doctitle" -->
		<title>Unity - Tuning Main Loop Performance</title>
	<!-- #TemplateEndEditable -->
</head>
<link rel="StyleSheet"  href="../Images/docs.css" type="text/css" />
<body>
<table class="titlebar" cellpadding=0 cellspacing=0 border=0><tr>
	<td class="titleleft"><img src="../Images/top/left.png"></td>
	<td><a href="../../Documentation.html"><img src="../Images/top/logo.png"></a></td>
	<td class="titlemid">
		<table><tr>
			<td class="doctitle">Tuning Main Loop Performance</td>
			<td class="Manual" align="right"><a href="../Manual/index.html" title="Go to Unity manual"><img src="../Images/spacer.gif" width="72" height="36" class="manual" border="0"></a></td>
			<td class="Manual" width="94"><a href="../Components/index.html" title="Go to Reference"><img src="../Images/spacer.gif" width="94" height="36" class="reference" border="0"></a></td>
			<td class="Manual" width="82"><a href="../ScriptReference/index.html" title="Go to Scripting Reference"><img src="../Images/spacer.gif" width="82" height="36" class="scripting" border="0"></a></td>
		</tr><tr>
			<td colspan="4">
				<table width="100%" class="docpath"><tr><td >
		<!-- #TemplateBeginEditable name="path" -->
					<a href="../Manual/index.html">Unity Manual</a> &gt; <a href="../Manual/iphone-GettingStarted.html">Getting Started with iPhone Development</a> &gt; <a href="../Manual/iphone-performance.html">Optimizing iPhone Performance</a> &gt; <a href="../Manual/iphone-Optimizing-MainLoop.html">Tuning Main Loop Performance</a>
		<!-- #TemplateEndEditable -->	
				</td>
				</td><td class="switchlink">
					<!--BeginSwitchLink--><!--EndSwitchLink-->
				</td></tr></table>
			</td>
		</tr></table>
	</td>
	<td class="titleright" width="9"><img src="../Images/top/right.png"></td>
</tr></table>
<div class="manual">
	<div class="main">

		<!-- #TemplateBeginEditable name="navigation" -->
		<div class="nav">
		<div class="nav-prev">
			<a href='../Manual/iphone-InternalProfiler.html'>
				<div class="nav-left"></div>
				<div class="nav-main">Previous</div>
				<div class="nav-right"></div>
			</a>
		</div>
	
		<div class="nav-next">
			<a href='../Manual/iphone-playerSizeOptimization.html'>
				<div class="nav-left"></div>
				<div class="nav-main">Next</div>
				<div class="nav-right"></div>
			</a>
		</div>
	</div>
		<!-- #TemplateEndEditable -->	
		<!-- #TemplateBeginEditable name="title" -->
			<h1>Tuning Main Loop Performance</h1>
		<!-- #TemplateEndEditable -->	
		<!-- #TemplateBeginEditable name="body" -->
			
<h2>Setting up desired frame-rate</h2>
<p>Unity iPhone allows you to tweak how many times per second your application will try to execute its rendering loop. By default it is 30 times per second. By lowering this number your application will save more battery power, but will render fewer frames per second. By increasing this value, rendering will be prioritized over other activities such as touch input and accelerometer processing. You will need to experiment with the frame-rate selection and determine for yourself the impact it has on your specific game.
</p>
<p class='vspace'>If your application is computational or rendering heavy and can maintain say only 15 frames per second, then setting desired frame rate over 15 wouldn't make any sense. First you have to optimize your application, then increase desired frame-rate.
</p>
<p class='vspace'>To set the desired frame-rate, open your <span class='wikiword'>XCode</span> project generated by Unity iPhone, and select the <code><span class='wikiword'>AppController</span>.mm</code> file. Locate and change <code class='escaped'>#define kFPS 30</code> to a desired value, for example: <code class='escaped'>#define kFPS 60</code>.
</p>
<div class='vspace'></div><h2>Tuning the rendering loop</h2>
<p>The Apple suggested way of using System Timer for scheduling rendering is perfect for non-performance critical applications which favours battery life and scrupulous correct events processing over rendering performance. However some games might prefer frame-rate over battery life, therefore Unity provides alternate methods which allows you to run in a tighter rendering loop:
</p><ul><li>System Timer - approach usually suggested by Apple. Uses <span class='doc-prop'><span class='wikiword'>NSTimer</span></span> to schedule rendering. Has worst performance, but guarantees to process all input events.
</li><li>Thread - separate thread is used to schedule rendering. Provides good performance improvement comparing with System Timer approach, but sometimes could miss touch or accelerometer events. This approach is easiest to setup.
</li><li>Event Pump - uses <span class='doc-prop'><span class='wikiword'>CFRunLoop</span></span> object to dispatch events. Provides good performance improvement comparing with System Timer approach. Allows you to explicitly define how much time operating system should spend on processing touch and accelerometer events. Care must be taken however as lack of time will result in lost touch or accelerometer events.
</li></ul><p class='vspace'>Default rendering loop type is Thread based.
</p>
<div class='vspace'></div><h3>Setting up System Timer based main loop</h3>
<p>Open the <span class='wikiword'>XCode</span> project generated by Unity iPhone. Select the <code><span class='wikiword'>AppController</span>.mm</code> file, locate and uncomment <code class='escaped'>#define MAIN_LOOP_TYPE NSTIMER_BASED_LOOP</code>, make sure both defines for other main loop types are removed or commented out:
</p>
<div class='vspace'></div><pre class='codelisting'>
#define MAIN_LOOP_TYPE NSTIMER_BASED_LOOP
//#define MAIN_LOOP_TYPE THREAD_BASED_LOOP
//#define MAIN_LOOP_TYPE EVENT_PUMP_BASED_LOOP
</pre>
<p class='vspace'>If you want to prioritize rendering over input processing with System Timer based approach you have to locate and change <code class='escaped'>#define kThrottleFPS 2.0</code> in <code><span class='wikiword'>AppController</span>.mm</code> file, for example to <code class='escaped'>#define kThrottleFPS 4.0</code>. Increasing this number will give higher priority to rendering. The result of changing this value might differ for different applications, so it's best to try it for yourself and see the impact on your specific case.
</p>
<div class='vspace'></div><h3>Setting up Thread based main loop</h3>
<p>Open the <span class='wikiword'>XCode</span> project generated by Unity iPhone. Select <code><span class='wikiword'>AppController</span>.mm</code> file, locate and uncomment <code class='escaped'>#define MAIN_LOOP_TYPE THREAD_BASED_LOOP</code>, make sure both defines for other main loop types are removed or commented out:
</p>
<div class='vspace'></div><pre class='codelisting'>
//#define MAIN_LOOP_TYPE NSTIMER_BASED_LOOP
#define MAIN_LOOP_TYPE THREAD_BASED_LOOP
//#define MAIN_LOOP_TYPE EVENT_PUMP_BASED_LOOP
</pre>
<div class='vspace'></div><h3>Setting up Event Pump based main loop</h3>
<p>Open the <span class='wikiword'>XCode</span> project generated by Unity iPhone. Select <code><span class='wikiword'>AppController</span>.mm</code> file, locate and uncomment <code class='escaped'>#define MAIN_LOOP_TYPE EVENT_PUMP_BASED_LOOP</code>, make sure both defines for other main loop types are removed or commented out:
</p>
<div class='vspace'></div><pre class='codelisting'>
//#define MAIN_LOOP_TYPE NSTIMER_BASED_LOOP
//#define MAIN_LOOP_TYPE THREAD_BASED_LOOP
#define MAIN_LOOP_TYPE EVENT_PUMP_BASED_LOOP
</pre>
<p class='vspace'>If you chose the Event Pump based rendering loop, then you have to carefully tweak the kMillisecondsPerFrameToProcessEvents constant to achieve the desired responsiveness. The kMillisecondsPerFrameToProcessEvents constant allows you to specify exactly how much time (in millisecond) you will allow the OS to process events. If you allocate insufficient time for this task, then touch or accelerometer events might be lost resulting in a fast, but less responsive application.
</p>
<p class='vspace'>To specify the amount of time (in millisecond) that the OS will spend processing events, you have to locate and change <code class='escaped'>#define kMillisecondsPerFrameToProcessEvents 7.0</code> in <code><span class='wikiword'>AppController</span>.mm</code> file, for example to <code class='escaped'>#define kMillisecondsPerFrameToProcessEvents 3.0</code>
</p>
<div class='vspace'></div><h2>Tuning accelerometer processing frequency</h2>
<p>A high frequency of accelerometer input processing might have a negative impact on overall performance of your game. By default iPhone Unity application will query the accelerometer input 60 times per second. You might discover an additional performance improvement by lowering the accelerometer frequency or even setting it to 0, if your game is not using the accelerometer at all.
</p>
<p class='vspace'>To specify desired processing frequency for the accelerometer you will have to open the Unity generated <span class='wikiword'>XCode</span> project, select <span class='wikiword'>AppController</span>.mm file and change <code class='escaped'>#define kAccelerometerFrequency 60</code> to a different value, for example: <code class='escaped'>define kAccelerometerFrequency 10</code>
</p>

		<!-- #TemplateEndEditable -->	

		<div class="nav">
		<div class="nav-prev">
			<a href='../Manual/iphone-InternalProfiler.html'>
				<div class="nav-left"></div>
				<div class="nav-main">Previous</div>
				<div class="nav-right"></div>
			</a>
		</div>
	
		<div class="nav-next">
			<a href='../Manual/iphone-playerSizeOptimization.html'>
				<div class="nav-left"></div>
				<div class="nav-main">Next</div>
				<div class="nav-right"></div>
			</a>
		</div>
	</div>
	</div>
</div>
</body></html>
<!-- #EndTemplate -->
